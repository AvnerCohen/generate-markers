<!doctype html>
<html>
    <head>
        <title>Generate Google Maps Markers</title>
        <meta name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no">        
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>        
        <script type="text/javascript" src="./js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>           
        
	    <style type="text/css">
	      html, body, #map_canvas {
	        margin: 0;
	        padding: 0;
	        height: 100%;
            width: 100%;
	      }
	    </style>
     
        <meta charset="utf-8" />
        <script>

        var markerGenerator = {};
        markerGenerator.markers = [];
        var geocoder = new google.maps.Geocoder();
       	var map = null; 

	      var init = function () {
	        var myOptions = {
	          zoom: 7,
	          center: new google.maps.LatLng(16.77532, -3.008265),
	          mapTypeId: google.maps.MapTypeId.ROADMAP
	        };
	        map = new google.maps.Map(document.getElementById('map_canvas'),
	            myOptions);

            google.maps.event.addListener(map, 'idle', generateSome);

	      }

          var getBounds = function (){

            var bounds  = map.getBounds();
            return {
                south_west_lat : bounds.getSouthWest().lat(),
                south_west_lng : bounds.getSouthWest().lng(),
                north_east_lat : bounds.getNorthEast().lat(),
                north_east_lng : bounds.getNorthEast().lng()
            }
          }

          var FACTOR = 1000;
          var MARKERS_TO_GENERATE = 30;
          function generateSome(){
           var bounds  = getBounds();
            clearMarkers();
            generateMarkers(MARKERS_TO_GENERATE, bounds);
            
          }

          function clearMarkers(){
            var markers = markerGenerator.markers;
            for(var i =0;i<markers.length;i++){
                    markers[i].setMap(null);
            }
            markerGenerator.markers = [];

          }

          function generateMarkers(times, bounds){
            for (var i = 0; i < times; i++){
                var lat = randomXToY(bounds.north_east_lat*FACTOR, bounds.south_west_lat*FACTOR, 5)/FACTOR;
                var lng = randomXToY(bounds.north_east_lng*FACTOR, bounds.south_west_lng*FACTOR, 5)/FACTOR;

                validateMarker("Point at: ["+ lat + "," +lng+ "]." , lat, lng);
            } 
          }


          function randomXToY(minVal,maxVal,floatValm)
            {
              var randVal = minVal+(Math.random()*(maxVal-minVal));
              return typeof floatVal=='undefined'?Math.round(randVal):randVal.toFixed(floatVal);
            }


            function validateMarker( caption, lat, lng){


                var position = new google.maps.LatLng(lat, lng);

                checkValidityOfPoint({position : position, caption :caption});

            }



            function checkValidityOfPoint(params){
            var request = { latLng: params.position.latLng,
                            bounds: map.getBounds() };
              geocoder.geocode(request, function(response, status)
               {
                    checkGeocodingResponse(response, status, params);
                });
            }

            function checkGeocodingResponse(response, status, params){

             var isGood =  (status == "OK" && 
                        response && response[0].types != "natural_feature") ?  true : false;

            var color = (isGood) ? "4D00FF" : "FF0033";

            color = (status == "OVER_QUERY_LIMIT") ? "D7FF7A" : color; 

            if(!isGood)
            {
                var aa=response;
            }

                var pin = getPinByColor(color);

                 var marker = new google.maps.Marker({
                    position: params.position,
                    map: map,
                    title: params.caption,
                    icon: pin.image,
                    shadow: pin.shadow
                });
                markerGenerator.markers.push(marker);            


            }

        var getPinByColor = function(pinColor){

            return {
            image : new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
                new google.maps.Size(21, 34),
                new google.maps.Point(0,0),
                new google.maps.Point(10, 34)), 

            shadow : new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
                new google.maps.Size(40, 37),
                new google.maps.Point(0, 0),
                new google.maps.Point(12, 35))
            };
        }

        $(document).ready(function() {

            google.maps.event.addDomListener(window, 'load', init);

         });
        </script>
    </head>
    <body>
     <div id="map_canvas"></div>
        <link rel="stylesheet" href="./css/bootstrap.min.css" />
        <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" />
    </body>
</html>